name: CI APT Bootstrap

on:
  push:
    branches: ["**"]
  pull_request:
    branches: ["**"]

jobs:
  bootstrap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Prepare APT and install deps
        shell: bash
        run: |
          set -euo pipefail
          sudo rm -f /etc/apt/apt-mirrors.txt || true
          sudo apt-get update
          retry() { for i in {1..3}; do "$@" && break || { echo "Retry $i/3 failed"; sleep 3; }; done; }
          retry sudo apt-get install -y --no-install-recommends \
            bison build-essential curl flex git gnat imagemagick libncurses5-dev m4 nasm python-is-python3 uuid-dev zlib1g-dev
          echo "APT bootstrap completed successfully."
